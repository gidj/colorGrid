{% extends 'base.html' %}

{% block title %}
{{ title }}
{% endblock %}

{% block content %}
<table>
    <tbody id="grid">
        {% for row in grid %}
        <tr id="{{ forloop.counter }}">
            {% for cell in row %}
            <td id="{{ forloop.counter }}">
                {{ cell }}
            </td>
            {% endfor %}
        </tr>
        {% endfor %}
    </tbody>
</table>

<button onclick="print_arr(grid)">Check Array</button>
<button onclick="rotate_grid_and_paint(grid)">Rotate Grid</button>


<script src="/static/js/grid.js"></script>
<script type="text/javascript">

    // These are the random numbers generated from the Django view
var grid = {{ grid|safe }}

// This routine convertes them into valid RGB Hex values
for(i = 0; i < grid.length; i++) {
    for(j = 0; j < grid[i].length; j++) {
        octal_num = grid[i][j];

        r = parseInt(octal_num.slice(0, 3), 8);
        g = parseInt(octal_num.slice(3, 6), 8);
        b = parseInt(octal_num.slice(6, 9), 8);

        if(r > 255) { 
            r = r - 256;
        }
        if(g > 255) { 
            g = g - 256;
        }
        if(b > 255) { 
            b = b - 256;
        }

        r = r.toString(16);
        g = g.toString(16);
        b = b.toString(16);

        if(r.length < 2) {
            r = '0' + r;
        }
        if(g.length < 2) {
            g = '0' + g;
        }
        if(b.length < 2) {
            b = '0' + b;
        }

        rgb = r + g + b;

        grid[i][j] = rgb.toUpperCase();
    }
}

paint_colors(grid);





// --------------------


function rotate_grid_and_paint() {
    if (grid.length % 2 == 1) {
        grid = rotate_odd_grid(grid);
    } else {
        grid = rotate_even_grid(grid);
    }
    paint_colors(grid);
}

function rotate_even_grid(arr) {
}

function rotate_odd_grid(arr) {
    // initialize a new array to have the right number of rows
    newarr = []
    for(i = 0; i < arr.length; i++) {
        newarr[i] = [];
    }
        
    // calculate the center element, which will help determin the rotated cell
    center = (arr.length - 1) / 2;

    // based on where the current cell indices are, calculate its rotated indices
    for (i = 0; i < arr.length; i++) {
        for (j = 0; j < arr.length; j++) {
            if (i < center) {
                if (j < i) {
                    newarr[i-1][j] = arr[i][j];
                } else if (j < (arr.length - 1 - i)) {
                    newarr[i][j+1] = arr[i][j];
                } else {
                    newarr[i+1][j] = arr[i][j];
                }
            } else if (i == center) {
                if (j < center) {
                    newarr[i-1][j] = arr[i][j];
                } else if (j > center) {
                    newarr[i+1][j] = arr[i][j];
                } else {
                    newarr[i][j] = arr[i][j];
                }
            } else {
                if (j < (arr.length - i)) {
                    newarr[i-1][j] = arr[i][j];
                } else if (j <= i) {
                    newarr[i][j-1] = arr[i][j];
                } else {
                    newarr[i+1][j] = arr[i][j];
                }
            }
        }
    }
    return newarr;
}

function paint_colors(arr) {
    g = document.getElementById('grid');
    rows = g.children;

    for(i = 0; i < rows.length; i++) {
        cells = rows[i].children
            for(j = 0; j < cells.length; j++) {
                cells[j].setAttribute('bgcolor', arr[i][j]);
            }
    }
}

function octal2hexstring(octstring) {
    arr = [];
    for(i = 0; i < 3; i++) {
        // for each three-digit triplet in octstring, treat as an octal
        // number, parse to an Integer, and place in arr
        arr[i] = parseInt(octstring.slice(3*i, 3*(i+1)), 8);

        // Each octal triplet can hold values in the range 0 - 511; we only
        // want values in the range 0 - 255; so if the converted octal 
        // integer is between 256 and 511, subtract 256 to give an integer 
        // in the desired range.
        if(arr[i] > 255) { arr[i] -= 256; }
    }

    // Convert and concantenate the integers in the array to a valid RGB
    // hex string
    rgb = arr[0].toString(16) + arr[1].toString(16) + arr[2].toString(16);

    return rgb;
}

function print_arr(a) {
    body = document.body;
    para = document.createElement('p');
    for (i = 0; i < a.length; i++) {
        para.appendChild(document.createElement('p'));
        para.appendChild(document.createTextNode(a[i]));
    }
    body.appendChild(para);
}


function octalstr_to_hexstring(str) {
    octnum = parseInt(str, 8);
    hexstr = octnum.toString(16);
    return hexstr;
}

</script>

{% endblock %}`
